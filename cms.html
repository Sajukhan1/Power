<!DOCTYPE html>
<html>
<head>
  <title>YouTube Uploader Panel</title>
  <style>
    body { font-family: Arial; padding: 30px; background: #f9f9f9; }
    input, textarea, button { display: block; margin: 15px 0; padding: 10px; width: 100%; max-width: 600px; }
    button { background: #cc0000; color: white; border: none; font-weight: bold; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>YouTube Video Upload + Geo-Restrict (BD Only)</h2>

  <input type="file" id="videoFile" accept="video/mp4">
  <input type="text" id="title" placeholder="Video Title">
  <textarea id="description" placeholder="Video Description"></textarea>
  <input type="text" id="tags" placeholder="Comma-separated tags (e.g. music,bd,funny)">

  <button onclick="uploadVideo()">Upload & Geo-Restrict</button>

  <div id="status"></div>

  <script>
    async function uploadVideo() {
      const accessToken = localStorage.getItem("yt_access_token");
      if (!accessToken) return alert("Token missing. Please login again.");

      const videoFile = document.getElementById("videoFile").files[0];
      const title = document.getElementById("title").value;
      const description = document.getElementById("description").value;
      const tags = document.getElementById("tags").value.split(",");

      const metadata = {
        snippet: { title, description, tags },
        status: { privacyStatus: "private" }
      };

      const form = new FormData();
      form.append("snippet", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
      form.append("video", videoFile);

      document.getElementById("status").innerText = "Uploading...";

      const uploadRes = await fetch("https://www.googleapis.com/upload/youtube/v3/videos?part=snippet,status", {
        method: "POST",
        headers: { Authorization: "Bearer " + accessToken },
        body: form
      });

      const uploadJson = await uploadRes.json();
      const videoId = uploadJson.id;

      if (videoId) {
        document.getElementById("status").innerText = "Upload successful! Applying geo restriction...";

        const restrictRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails`, {
          method: "PUT",
          headers: {
            "Authorization": "Bearer " + accessToken,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            id: videoId,
            contentDetails: {
              regionRestriction: {
                allowed: ["BD"]
              }
            }
          })
        });

        if (restrictRes.ok) {
          document.getElementById("status").innerText = `âœ… Upload & geo-block success! Video ID: ${videoId}`;
        } else {
          document.getElementById("status").innerText = `Upload done, but geo-block failed.`;
        }
      } else {
        document.getElementById("status").innerText = "Upload failed!";
      }
    }
  </script>
</body>
</html>
